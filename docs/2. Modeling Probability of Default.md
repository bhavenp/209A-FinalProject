---
title: Modeling Probability of Default
notebook: 2. Modeling Probability of Default.ipynb
nav_include: 5
---

# 2. Modeling Probability of Default

Modeling the probability that a loan defaults is critical to our investment strategy. After our exploration of 2013 and 2014 data, we select predictors that present promising separations between defaulted and repaid loans. We also make sure not to use any predictors capturing information that we would not have at the time of selecting which loans to invest in.

---

### Summary of variables

**Response:**

Newly defined variable, `paid`, which was a binary variable indicating whether a loan had any status other than 'Fully Paid'. 

**Predictors:**

- `funded_amnt`: The total amount committed to that loan at that point in time.
- `home_ownership` : The home ownership status provided by the borrower during registration or obtained from the credit report.    
- `int_rate` : Interest Rate on the loan.
- `purpose` : A category provided by the borrower for the loan request.
- `annual_inc`: The self-reported annual income provided by the borrower during registration.
- `verification_status`: Indicates if income was verified by LC, not verified, or if the income source was verified.
- `dti`: Debt to income ratio - ratio calculated using the borrower's total monthly debt payments on the total debt obligations, excluding mortgage and the requested LC loan, divided by the borrower's self-reported monthly income.
- `revol_util`:  Revolving utilization - ratio of total current balance to credit limit for all revolving accounts.
- `grade`: Lending club assigned loan grade.
- `term`: The number of payments on the loan. Values are in months and can be either 36 or 60.

    *We use one hot encoding for the categorical variables (employment length, home ownership, verification status, grade and purpose).*    
    *We normalize all columns with values that are not percentages (funded amount, annual income and debt-to-income ratio).*
    
    
---

## HIDE













### Handling Imbalanced Class

The algorithms we select to predict future loans as defaulting or not defaulting have trouble learning to predict underrepresented classes. As seen in the table below, the defaulted class in the training data is under represented. 

To address this class imbalance problem, we use synthesis of new minority class instances ([SMOTE](https://jair.org/index.php/jair/article/view/10302/24590)). For each minority class, SMOTE calculates the k nearest neighbors. Depending on the amount of oversampling required, one or more of the k-nearest neighbors are selecte to create synthetic examples to augment the training dataset. We oversample the defaulted loan class to achieve a 50-50 split of classes using the `imbalanced-learn` library.








<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>number of loans</th>
      <th>percent of loans</th>
      <th>SMOTE number of loans</th>
      <th>SMOTE
number of loans</th>
      <th>SMOTE
percent of loans</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>repaid</th>
      <td>289177</td>
      <td>0.78</td>
      <td>289177</td>
      <td>289177</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>defaulted</th>
      <td>81266</td>
      <td>0.22</td>
      <td>289177</td>
      <td>289177</td>
      <td>0.5</td>
    </tr>
  </tbody>
</table>
</div>



### Machine Learning Models

The task at hand is to predict the probability that a loan will default.

### List out all models considered

### Talk about how they were tuned

### Describe performance - training, test, winners that we took forward





    /anaconda3/lib/python3.7/site-packages/sklearn/base.py:251: UserWarning: Trying to unpickle estimator DecisionTreeClassifier from version 0.20.0 when using version 0.20.1. This might lead to breaking code or invalid results. Use at your own risk.
      UserWarning)
    /anaconda3/lib/python3.7/site-packages/sklearn/base.py:251: UserWarning: Trying to unpickle estimator AdaBoostClassifier from version 0.20.0 when using version 0.20.1. This might lead to breaking code or invalid results. Use at your own risk.
      UserWarning)
    /anaconda3/lib/python3.7/site-packages/sklearn/base.py:251: UserWarning: Trying to unpickle estimator GridSearchCV from version 0.20.0 when using version 0.20.1. This might lead to breaking code or invalid results. Use at your own risk.
      UserWarning)
    /anaconda3/lib/python3.7/site-packages/sklearn/base.py:251: UserWarning: Trying to unpickle estimator LogisticRegressionCV from version 0.20.0 when using version 0.20.1. This might lead to breaking code or invalid results. Use at your own risk.
      UserWarning)
    /anaconda3/lib/python3.7/site-packages/sklearn/base.py:251: UserWarning: Trying to unpickle estimator Pipeline from version 0.20.0 when using version 0.20.1. This might lead to breaking code or invalid results. Use at your own risk.
      UserWarning)
    /anaconda3/lib/python3.7/site-packages/sklearn/base.py:251: UserWarning: Trying to unpickle estimator PolynomialFeatures from version 0.20.0 when using version 0.20.1. This might lead to breaking code or invalid results. Use at your own risk.
      UserWarning)
    /anaconda3/lib/python3.7/site-packages/sklearn/base.py:251: UserWarning: Trying to unpickle estimator RandomForestClassifier from version 0.20.0 when using version 0.20.1. This might lead to breaking code or invalid results. Use at your own risk.
      UserWarning)













<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Training Accuracy</th>
      <th>Training AUC</th>
      <th>Test Accuracy</th>
      <th>Test AUC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Logistic Regression</th>
      <td>0.65</td>
      <td>0.71</td>
      <td>0.75</td>
      <td>0.72</td>
    </tr>
    <tr>
      <th>Neural Network</th>
      <td>0.68</td>
      <td>0.71</td>
      <td>0.78</td>
      <td>0.71</td>
    </tr>
    <tr>
      <th>Light GBM</th>
      <td>0.79</td>
      <td>0.70</td>
      <td>0.70</td>
      <td>0.64</td>
    </tr>
    <tr>
      <th>Random Forest</th>
      <td>0.69</td>
      <td>0.72</td>
      <td>0.72</td>
      <td>0.64</td>
    </tr>
    <tr>
      <th>AdaBoost</th>
      <td>0.90</td>
      <td>0.96</td>
      <td>0.66</td>
      <td>0.62</td>
    </tr>
    <tr>
      <th>Quadratic Discriminant Analysis</th>
      <td>0.53</td>
      <td>0.53</td>
      <td>0.78</td>
      <td>0.50</td>
    </tr>
  </tbody>
</table>
</div>
















![png](2.%20Modeling%20Probability%20of%20Default_files/2.%20Modeling%20Probability%20of%20Default_17_0.png)



    <Figure size 720x720 with 0 Axes>

